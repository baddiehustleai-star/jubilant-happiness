name: 🪩 Notifications

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:

jobs:
  notify:
    name: Send Deployment Notifications
    runs-on: ubuntu-latest

    steps:
      - name: ✅ Check out repository
        uses: actions/checkout@v4

      - name: 🧾 Prepare notification message
        id: message
        run: |
          echo "MESSAGE=🚀 Photo2Profit deployment triggered on branch '${GITHUB_REF##*/}' by ${GITHUB_ACTOR}" >> $GITHUB_ENV

      # ───────────────────────────────
      # OPTIONAL: Discord Notification
      # ───────────────────────────────
      - name: � Send Discord Notification
        if: env.DISCORD_WEBHOOK != '' || env.DISCORD_WEBHOOK != null
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          MESSAGE: ${{ env.MESSAGE }}
        run: |
          if [ -n "$DISCORD_WEBHOOK" ]; then
            curl -H "Content-Type: application/json" \
              -d "{\"content\": \"$MESSAGE\"}" \
              "$DISCORD_WEBHOOK"
          else
            echo "⚠️ No DISCORD_WEBHOOK secret set — skipping Discord notification."
          fi

      # ───────────────────────────────
      # OPTIONAL: Slack Notification
      # ───────────────────────────────
      - name: � Send Slack Notification
        if: env.SLACK_WEBHOOK != '' || env.SLACK_WEBHOOK != null
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
          MESSAGE: ${{ env.MESSAGE }}
        run: |
          if [ -n "$SLACK_WEBHOOK" ]; then
            curl -X POST -H 'Content-type: application/json' \
              --data "{\"text\":\"$MESSAGE\"}" \
              "$SLACK_WEBHOOK"
          else
            echo "⚠️ No SLACK_WEBHOOK secret set — skipping Slack notification."
          fi

      # ───────────────────────────────
      # Log success
      # ───────────────────────────────
      - name: 🪩 Done
        run: echo "✨ Notification workflow completed successfully!"
